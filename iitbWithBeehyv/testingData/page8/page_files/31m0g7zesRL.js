(function(n,p,y){n.execute(function(){n.when("twister-variation-matrix","twister-dim-util","twister-state-machine","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(f,k,h,g,e,c,m,b,a){function l(d,m){this.tvm=new f(d);this.util=new k(this.tvm);this.tsm=new h(this.tvm,this.util,d.initDimCombination);this.dimSum=new a(d.config.ajaxTimeout,d.config.ajaxUrlParams,d.config.deviceType,m);this.slotsDimSum=
new b(d.config.ajaxTimeout,d.config.ajaxUrlParams,d.config.deviceType);var l=this;c.registerStore("twister-state-machine",function(a,b){l.tsm.accept(a,b).THEN(function(b){e.publishView(a,b)}).ELSE()});var n=new g;c.registerStore("twister-metadata",function(a,b){n.process(a,b,function(b){e.publishView(a,b)})})}function d(a,b){var d=a.viewAttribution+"_"+a.viewName+"_"+b;return function(a){try{var e=m.create(b,a);c.dispatch(b,e)}catch(f){p.ueLogError&&p.ueLogError(f,{logLevel:"ERROR",attribution:"Twister_view_"+
d,message:"This error is caused by the Twister view - "+d+" while updating the TwisterCore"})}}}l.prototype={registerActive:function(a,b){e.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{dimensionChanged:d(a,"VARIATION_CHANGE"),dimensionPeek:d(a,"VARIATION_PEEK"),metaData:d(a,"METADATA")}},registerPassive:function(a,b){e.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{metaData:d(a,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};
return l});n.when("A").register("twister-actions",function(f){var k=f.$,h={VARIATION_CHANGE:function(f){return f=k.isArray(f)?f:[f]},VARIATION_PEEK:function(f){return f},METADATA:function(f){return f}};return{create:function(f,e){return h[f]?h[f](e):!1}}});n.when("A","publisherSubscriber").register("twister-dispatcher",function(f,k){function h(){h=1;return this}var g=f.$,e=new k,h=0,c=[];return{registerStore:function(c,b){e.register(c,b);return this},deregisterStore:function(c){e.deRegister(c);
return this},dispatch:function(f,b){h?c.push(arguments):e.publish(f,b);return this},hold:h,release:function(){g.each(c,function(c,b){e.publish.apply(e,b)});h=0;return this}}});n.when("A","publisherSubscriber").register("twister-view-controller",function(f,k){function h(){e?c.push(arguments):(e=1,g.publish.apply(g,arguments),e=0,c.length&&h.apply(this,c.shift()));return this}var g=new k,e=0,c=[];return{register:function(c,b){g.register(c,b);return this},deRegister:function(c){g.deRegister(c);
return this},publishView:h}});n.when("A").register("twister-dimsel-api",function(f){function k(f){var e=this;this.dimSelectionMap={};this.selInfo=f;h.each(f,function(c,f){e.dimSelectionMap[f.dimKey]=f.val})}var h=f.$;k.prototype={matches:function(f){f=f.selectionInfo();for(var e=0;e<f.length;e++){var c=f[e].dimKey;if(!(c in this.dimSelectionMap)||this.dimSelectionMap[c]!==f[e].val)return!1}return!0},selectionInfo:function(){return f.copy(this.selInfo)}};return k});n.when("A",
"twister-dimsel-api").register("twister-dim-util",function(f,k){function h(e){this.tvm=e;this.dimensionMetaData={};var c=[];e=e.dimensionInfo;for(var f=0;f<e.length;f++){c.push(e[f].dimKey);var b={};b.isRequired=e[f].isRequired;b.isSingleton=e[f].isSingleton;b.dimOrder=f;b.size=e[f].size;this.dimensionMetaData[e[f].dimKey]=b}}var g=f.$;h.prototype={createSelectionInfo:function(e){return new k(e)},extendSelectionInfo:function(e,c,f){var b=f||0===f,a={},h=[];g.each(c.selectionInfo(),function(b,c){a[c.dimKey]=
c.val});g.each(e.selectionInfo(),function(c,e){var g=e.dimKey,k=b?f:e.val;g in a&&(k=a[g]);h.push({dimKey:g,val:k})});return new k(h)},createNextDimSelection:function(e,c){var f=[],b=c.selectionInfo(),a=this;g.each(e.split(":"),function(c,d){var e=b[c].dimKey,g=parseInt(d,10);a.dimensionMetaData[e].isRequired&&g!==b[c].val&&(g=-1);f.push({dimKey:e,val:g})});return new k(f)},getDimScore:function(e,c){var f=0,b=e.split(":"),a=this;g.each(c.selectionInfo(),function(c,d){var e=d.dimKey,g=d.val,h=parseInt(b[c],
10),k=b.length-c;g===h?(f+=200*k,a.dimensionMetaData[e].isRequired&&(f+=2E4)):(g=Math.abs(g-h),e=Math.round(g/a.dimensionMetaData[e].size*100),f+=100-e)});return f},isSingletonDim:function(e){return this.dimensionMetaData[e]?this.dimensionMetaData[e].isSingleton:!1},isRequiredDim:function(e){return this.dimensionMetaData[e]?this.dimensionMetaData[e].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(e,c){c=c.selectionInfo?c:this.createSelectionInfo(c);
var f=[],b=[],a=this.tvm.dimensionList,h=this.tvm.dimtoValueMap[e],d=this.createSelectionInfo([{dimKey:e,val:-1}]),d=this.tvm.fetch(this.extendSelectionInfo(c,d).selectionInfo()),k={},n=this;g.each(d,function(b,c){k[c.split(":")[a.indexOf(e)]]=n.tvm.dimCombinations[c]});g.each(h,function(a,c){a in k?f.push({index:a,asin:k[a],label:c}):b.push({index:a,label:c})});return{available:f,unavailable:b}},getUnselectedDims:function(e){var c={};g.each(e,function(a,b){c[b.dimKey]=b.val});e=[];var f=this.tvm.dimensionList,
b;for(b in f)if(f.hasOwnProperty(b)){var a=f[b];if(c[a]===y||-1===c[a])this.isSingletonDim(a)?c[a]=0:e.push(a)}return e},showDimSum:function(e,c){var f=this.getUnselectedDims(c);return!f||0===f.length||1===f.length&&f[0]===e?1:0},isFullySelected:function(e){var c=!0;"string"===typeof e&&(e=this.getSelectionInfoFromDimComb(e));e=e.selectionInfo?e.selectionInfo():e;if(e.length!=this.tvm.dimensionList.length)return!1;g.each(e,function(e,b){-1===b.val&&(c=!1)});return c},createDimensionSelectionMap:function(e){var c=
{},f;for(f in e)if(e.hasOwnProperty(f)){var b=e[f];c[b.dimKey]=b.val}return c},getSelectedDimKeys:function(e){var c=this.tvm.dimensionList,f=[],b;for(b in c)if(c.hasOwnProperty(b)){var a=e[c[b]];"undefined"===typeof a||-1==a?f.push("*"):f.push(a)}return f},getValidDimCombination:function(e,c){var f,b,a=this,h=0,d=0;b=this.tvm.fetch(e);g.each(b,function(b,e){d=a.getDimScore(e,c);d>h&&(f=b,h=d)});return b[f]},getAsinFromSelectionInfo:function(e,c){var h,b;"undefined"==typeof c||c?h=this.createDimensionSelectionMap(e):
(b=f.copy(e),h=this.getValidDimCombination(b,this.createSelectionInfo(e)),g.each(h.split(":"),function(a,c){var d=parseInt(c,10);b[a].val=d}),h=this.createDimensionSelectionMap(b));h=this.getSelectedDimKeys(h).join(":");return this.tvm.dimCombinations[h]},getSelectionInfoFromSelectedVariationValuesMap:function(e){var c=[],f;for(f in this.tvm.dimensionList){var b={},a=this.tvm.dimensionList[f];b.dimKey=a;b.val=e[a];c.push(b)}return c},getSelectionInfoFromDimComb:function(e){var c=[];e=e.split("_");
for(var f in this.tvm.dimensionList){var b={},a=e[f];b.dimKey=this.tvm.dimensionList[f];b.val="X"===a||"*"===a?-1:parseInt(a,10);c.push(b)}return c},getSelectionInfoFromDimIndexAndValue:function(e,c){var f=[],b={};b.dimKey=this.tvm.dimensionList[e];b.val="X"===c||"*"===c?-1:parseInt(c,10);f.push(b);return f},predictNextState:function(e,c){var f=this.extendSelectionInfo(e,c);if(function(a){var b;g.each(a.selectionInfo(),function(a,c){b=-1===c.val});return b}(c)||this.tvm.exists(f.selectionInfo()))return f;
for(var b=this.extendSelectionInfo(e,c,-1),b=this.tvm.fetch(b.selectionInfo()),a=0,h=0,d,k=0;k<b.length;k++)h=this.getDimScore(b[k],f),h>a&&(d=k,a=h);return this.createNextDimSelection(b[d],f)}};return h});n.when("A","url-builder").register("twister-dimsum",function(f,k){function h(e,c,g,b){this.cache;b&&(this.cache=new b);this.ajaxTimeout=e;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList=###asinString###&vs=1"+(c||"");g&&(this.ajaxUrl+="&deviceType="+g);(e=f.state("pwState"))&&
e.isTryState&&(this.ajaxUrl=k.addUrlParams(this.ajaxUrl,{isTryState:"true"}))}var g=f.$;h.prototype={get:function(e,c,h){function b(c){var d=c-this.batchLimit,e="";0<d&&b.call(this,d);if(e=n.slice(0>d?0:d,c).join(","))c=this.ajaxUrl.replace("###asinString###",e),f.ajax(c,{chunk:a,timeout:this.ajaxTimeout})}function a(a){if(a)for(var b in a)if(a.hasOwnProperty(b)){var e=a[b];if(e&&e.asin){if(d){var f=k(e.asin,h);d.put(f,e)}c&&c(e)}}}function k(a,b){var c=a;f.objectIsEmpty(b)||(c={asin:a},g.extend(!0,
c,b));return c}var d=this.cache,n=[],p={};g.each(e,function(a,b){var e=k(b,h);d&&d.get(e)?c?c(d.get(e)):p[b]=d.get(e):n.push(b)});if(!c)return p;b.call(this,n.length)}};return h});n.when("A").register("twister-slots-dimsum",function(f){function k(c,e,b){this.cache=g;this.ajaxTimeout=c;this.batchLimit=8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax=1&asinList=###asinString###&vs=1"+(e||"");b&&(this.ajaxUrl+="&deviceType="+b)}var h=f.$,g={},e={};k.prototype={get:function(c,g){function b(c){var d=
c-this.batchLimit,e="",g=[];0<d&&b.call(this,d);g=n.slice(0>d?0:d,c);if(e=g.join(","))c=this.ajaxUrl.replace("###asinString###",e),f.ajax(c,{chunk:k,timeout:this.ajaxTimeout,cache:!0,error:a.apply(null,g)})}function a(){var a=arguments;return function(){f.each(a,function(a){delete e[a]})}}function k(a){if(a&&a.ASIN){var b=a.ASIN;d[b]=a;for(g&&g(a);e[b]&&e[b].length;)e[b].pop()(a);delete e[b]}}var d=this.cache,n=[],p={};h.each(c,function(a,b){d[b]?g?g(d[b]):p[b]=d[b]:e[b]&&g?e[b].push(g):g&&(n.push(b),
e[b]=[])});if(!g)return p;n.length&&b.call(this,n.length)}};return k});n.register("twister-metadata",function(){function f(){this.config={}}f.prototype={process:function(f,h,g){"METADATA"===f&&g(h)}};return f});n.when("A").register("publisherSubscriber",function(f){function k(){this.Subscribers=[];this.Names=[]}var h=f.$;k.prototype={register:function(g,e){if(-1<f.indexOfArray(this.Names,g))return!1;this.Names.push(g);this.Subscribers.push({name:g,handler:e})},deRegister:function(g){var e=
f.indexOfArray(this.Names,g),c=this,m=function(b,a){if(b.name===g)return c.Subscribers.splice(a,1),!0};return-1<e?(this.Names.splice(e,1),[].some?this.Subscribers.some(m):h.each(this.Subscribers,function(b,a){m(a,b)}),!0):!1},publish:function(){var f=arguments;h.each(this.Subscribers,function(e,c){setTimeout(function(){c.handler.apply(null,f)},0)})}};return k});n.when("jQuery").register("twister-state-machine",function(f){return function(f,h,g){function e(a,b){this.selected=function(){return a};
this.peek=function(){return b}}function c(a,b){return{THEN:function(c){a&&c&&c(b());return this},ELSE:function(c){a||c&&c(b());return this}}}var m,b;this.accept=function(a,f){var d;switch(a){case "VARIATION_PEEK":var g=h.createSelectionInfo(f);d=m();d.peek().matches(g)?d=!1:(-1===f.val?d=new e(m.selected(),m.selected()):(g=h.predictNextState(d.peek(),g),d=new e(d.selected(),g)),b=d,d=!0);d=c(d,this.currentState);break;case "VARIATION_CHANGE":d=m();var g=h.createSelectionInfo(f),k=h.getDimensionInfo();
d.selected().matches(g)?d=!1:(d=g.selectionInfo().length!==k.length?h.predictNextState(d.selected(),g):g,b=new e(d,d),d=!0);d=c(d,this.currentState);break;default:d=c(!1)}return d};m=this.currentState=function(){return b};(function(a){b=a})(new e(h.createSelectionInfo(g),h.createSelectionInfo(g)))}});n.when("A").register("twister-variation-matrix",function(f){function k(c){c=f.copy(c);var g=this;this.dimCombinations=c.dimCombinations;this.validCombinatonString=" "+f.keys(c.dimCombinations).join("  ")+
" ";this.dimensionInfo=c.dimensionInfo;this.dimensionList=c.dimensionList;this.dimensionDisplayText=c.dimensionDisplayText;this.config=c.config;this.dimInfoMap={};e.each(this.dimensionInfo,function(b,a){var c=a.dimKey,d={};d.size=a.size;d.dimOrder=b;g.dimInfoMap[c]=d});this.dimtoValueMap=c.dimtoValueMap}function h(c){c=e.map(c,function(c){c=c.val;return-1===c?"\\d+":""+c}).join(":");return new RegExp("\\s"+c+"\\s","gm")}function g(c){return e.map(c,function(c){return""+c.val}).join(":")}var e=f.$;
k.prototype={fetch:function(c){c=h(c);c=this.validCombinatonString.match(c);return c=e.map(c,function(c){return e.trim(c)})},exists:function(c){return g(c)in this.dimCombinations}};return k});n.when("A","jQuery").register("url-builder",function(f,k){function h(c,e){var b;if(c&&e&&"object"==typeof e){b=c;var a="?";f.each(e,function(c,d){c=e[d];b+=a+d+"="+c;a="&"})}return b}function g(c){var e;c&&(e=c.split("?")[0]);return e}function e(c){var e={};c&&(c=c.split("?"),1<c.length&&(c=c[1].split("&"),
f.each(c,function(b,a){var c=b.split("=");e[c[0]]=c[1]})));return e}return{addUrlParams:function(c,f){var b=c;if(c&&f&&"object"==typeof f)var b=g(c),a=e(c),a=k.extend(a,f),b=h(b,a);return b},removeUrlParams:function(c,m){var b=c;if(c&&m&&"object"==typeof m){var b=g(c),a=e(c);f.each(m,function(b,c){delete a[b]});b=h(b,a)}return b}}})})})(function(){var n=window.AmazonUIPageJS||window.P,p=n._namespace||n.attributeErrors;return p?p("TwisterCoreAsset"):n}(),window);