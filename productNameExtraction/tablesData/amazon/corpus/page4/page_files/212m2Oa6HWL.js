(function(n,p,y){n.execute(function(){n.when("A","dp-refresh-handler","view-util","twister-string-constants").register("page-refresh-view",function(f,k,h,g){var e=f.$;return function(c,m,b){function a(a){return{chunk:function(a){var d=a.ASIN,b=a.Value;a=a.FeatureName;if(!q.hiddenFeatures[a]){var l,c;try{a&&b&&b.content&&(c=b.content[a],"undefined"!==typeof c&&(l=e("#"+a),l.html(c),l.css({opacity:""})))}catch(f){a=a||"NoFeatureName",C.logFatal(f,{message:"Error in feature"+a})}q.twisterRefreshHandler.stampFeature(a,
d)}},success:function(a,d,b){N("twisterUpdateSuccess")},error:function(a,d,b){Twister.$("#variations-overlay").hide();N("twisterUpdateFailure");Twister.showErrorMessageOnFailure&&(alert(Twister.errorMessageOnFailure),location.reload())},abort:function(a){C.logFatal("Ajax aborted: "+a)},timeout:4E4}}function l(a,d,b,l,c){var e={},f=[];"parent"===a?(e=B(d,l,"parent",c),f.parent=e,e=B(b,l,"partial",c),f.partial=e):(e=B(b,l,a,c),f[a]=e);return f}function d(a,d,b,l,c){for(var f in a)if(a.hasOwnProperty(f)){if("full"===
f){var m=b.dimensionType,t=q.twisterUtil.getDimensionInfo().length;q.twisterRefreshHandler.startMeasurement(b.newAsin,m,t,b.dimensionDisplayType)}m=a[f].twisterRefreshParams;t=a[f].notifyClientParams;c&&(e(q.config[f].affectedFeatures).css({opacity:.5}),q.twisterRefreshHandler.doPageRefresh(null,m,d,l));w(t.asin,t.id,f,c)}}function t(){e.each(m.contextMetaData,function(a,d){var b={},l=d.elementList||[],c=l.length,f=[];b.click={};b.mouseOver={};for(var m=0;m<c;m++){var t=e("#"+l[m].divToUpdate);f.push("#"+
l[m].divToUpdate);t.length&&l[m].customClientFunction&&(l[m].updateOnHover&&(b.mouseOver[l[m].divToUpdate]=t.attr("customfunctionname")),b.click[l[m].divToUpdate]=t.attr("customfunctionname"))}q.config[a].affectedFeatures=f.join(",");q.config[a].clientFeatures=b})}function w(a,d,b,l){var c="",c=l?g.EVENT_TYPE_CLICK:g.EVENT_TYPE_MOUSEOVER;e.each(q.config[b].clientFeatures[c],function(b,l){try{var c=function(){q.twisterRefreshHandler.stampImageLoad(a)};(function(){var a={};a.P=n;(function(){eval("var P = this.P;");
var a=y,a=eval("0, "+l);a(d,DetailPage.StateController,c)}).call(a)})()}catch(e){C.logFatal("Client feature - "+b+", threw and exception :- "+e)}})}function B(a,d,b,l){var c={},e={};c.asinList=a;c.id="parent"===b?a:"partial"===l?d:a;c.mType=b;c=u(b,c);b=!1;(l=f.state("pwState"))&&(b=l.isTryState);b&&(c.isTryState=b);c=q.twisterRefreshHandler.createCustomParamsMap({},c);e.asin=a;e.id=d;return{twisterRefreshParams:c,notifyClientParams:e}}function u(a,d){e.each(m.contextMetaData[a].mTypeSpecificURLParams,
function(a,b){d[a]=b});return d}function x(a){a=q.twisterUtil.getSelectionInfoFromSelectedVariationValuesMap(a.selected_variation_values);q.twisterUtil.isFullySelected(a)?q.currentPageSelectionState="full":q.currentPageSelectionState="partial"}function A(a){var d={};a=a.twisterUpdateURLInfo.immutableURLPrefix;a+="&isFlushing=2&dpEnvironment="+Twister.dpEnvironment;d.pageRefreshUrl=a;return d}function v(a){var d={};d.config=a.measurement;d.dimensionDisplayType=a.dimensionsDisplayType;d.storeID=a.storeID;
d.productGroupID=a.productGroupID;return d}function z(a,d){var b;"partial"===a&&"partial"===d&&(b="partial");"partial"===a&&"full"===d&&(b="full");"full"===a&&"partial"===d&&(b="parent");"full"===a&&"full"===d&&(b="full");return b}var q=this,r=p.ue,D="",C=new b("dpTwisterPageRefreshView");this.twisterUtil=c.util;this.twisterFeatureName="Twister";this.currentPageSelectionState;this.twisterRefreshHandler;this.config={partial:{},full:{},parent:{},master:{}};this.hiddenFeatures={intermediateEOS:1,EOS:1};
q.viewUtil=new h(c);q.subType;var N=function(a){r&&r.count&&r.count(a,(r.count(a)||0)+1)};(function(){x(m);t();var b={featureName:q.twisterFeatureName},e=A(m),f=v(m);q.twisterRefreshHandler=new k(b,e,f);c.registerPassive({viewAttribution:"DetailPage",viewName:"WebTwisterRefreshView"},{updateView:function(b,c){var e={};if(b!==g.METADATA){var e={},f=y;if(c)switch(b){case g.VARIATION_CHANGE:f=c.selected().selInfo;break;case g.VARIATION_PEEK:f=c.peek().selInfo}e.selectionInfo=f;e.childAsin=q.twisterUtil.getAsinFromSelectionInfo(e.selectionInfo);
e.newAsin=e.childAsin;e.dimensionCombination=q.viewUtil.getCurrDimCombId(e.selectionInfo,"_","X");e.newPageSelectionState=q.twisterUtil.isFullySelected(e.dimensionCombination)?"full":"partial";e.mTypeForRefresh=z(q.currentPageSelectionState,e.newPageSelectionState);e.doNotAbort="parent"===e.mTypeForRefresh?!0:!1;e.twisterCallListParams=l(e.mTypeForRefresh,e.newAsin,e.childAsin,e.dimensionCombination,e.newPageSelectionState);e.optionsForTwisterRefresh=a(c);e.pageRefreshMeasure={newAsin:e.newAsin,dimensionType:D,
dimensionDisplayType:m.dimensionsDisplayType}}switch(b){case g.VARIATION_CHANGE:q.subType!==g.PRODUCTIZED_VIEW_SUBTYPE&&(d(e.twisterCallListParams,e.optionsForTwisterRefresh,e.pageRefreshMeasure,e.doNotAbort,!0),q.currentPageSelectionState=e.newPageSelectionState,q.subType=y);break;case g.VARIATION_PEEK:d(e.twisterCallListParams,e.optionsForTwisterRefresh,e.pageRefreshMeasure,e.doNotAbort,!1);q.currentPageSelectionState=e.newPageSelectionState;break;case g.METADATA:switch(c.subType){case g.DP_STATE_VIEW_SUBTYPE:D=
c.divMetadata.dimDisplayType;break;case g.PRODUCTIZED_VIEW_SUBTYPE:q.subType=c.subType,e.dimensionCombination=c.newDimCombID,e.childAsin=c.childAsin,e.newAsin=c.newAsin,e.newPageSelectionState=q.twisterUtil.isFullySelected(e.dimensionCombination)?"full":"partial",e.mTypeForRefresh=z(q.currentPageSelectionState,e.newPageSelectionState),e.doNotAbort="parent"===e.mTypeForRefresh?!0:!1,e.twisterCallListParams=l(e.mTypeForRefresh,e.newAsin,e.childAsin,e.dimensionCombination,e.newPageSelectionState),e.optionsForTwisterRefresh=
a(c),e.pageRefreshMeasure={newAsin:e.newAsin,dimensionType:c.divMetaData?c.divMetaData.dimDisplayType:y,dimensionDisplayType:m.dimensionsDisplayType},d(e.twisterCallListParams,e.optionsForTwisterRefresh,e.pageRefreshMeasure,e.doNotAbort,!0),q.currentPageSelectionState=e.newPageSelectionState}}}})})()}})})})(function(){var n=window.AmazonUIPageJS||window.P,p=n._namespace||n.attributeErrors;return p?p("DetailPageTwisterViewAsset"):n}(),window);